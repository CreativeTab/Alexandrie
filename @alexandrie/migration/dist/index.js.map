{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/*\nNew categories:\n153009357737431040,Général (Maths)\n153009357787762689,Algèbre\n153009357787762690,Analyse\n153009357787762691,Géométrie\n153009357787762692,Probabilités et statistiques\n153009357791956997,Raisonnements\n153009590005403648,Algorithmie\n153009590005403649,Général (Physique)\n153009590005403650,Énergie\n153009590005403651,Optique\n153009590005403652,Matière\n153009590005403653,Ondes\n153009590005403654,Mécanique\n153009590005403655,Acides & Bases\n153009590005403656,Oxydoréduction\n\n\nOld categories:\n10247724590960640,Chimie (Acides & Oxydoréduction)\n135688451642101760,Optique\n1563846779080705,Général\n1564500943704066,Nombres\n1564753356918787,Algèbre\n1564854359953412,Analyse\n1564994986577925,Géométrie\n1565265611460614,Probabilités et statistiques\n1565634844430343,Algorithmie\n38224311751806976,Information\n3993900674977792,Général\n4030806225850368,Matière\n4031642125471745,Énergie\n44031625821949952,Ondes\n51632421858185216,Réseaux\n59881276756201472,Raisonnement \n61787697525559296,Environnement \n8124080637087744,Général\n8124501086703617,Modélisation de systèmes\n9154132401197056,Mécanique\n\n*/\n\nimport { type Pool, createPool } from 'mysql2';\nimport type { Article, ArticleDB, Document, DocumentDB } from './types';\n\nfunction getConnection(host?: string, user?: string, password?: string, db_name?: string) {\n  return createPool({\n    host: host,\n    user: user,\n    password: password,\n    database: db_name,\n  });\n}\n\nconst old_db: Pool = getConnection('localhost', 'root', 'root', 'docs');\nconst new_db = getConnection('localhost', 'root', 'root', 'alexandrie');\n\nfunction getAllOldArticles() {\n  return new Promise<Article[]>(resolve => {\n    old_db.query<ArticleDB[]>('SELECT * FROM articles', (err, result) => {\n      if (err) console.log(err);\n      resolve(result);\n    });\n  });\n}\nfunction formatArticleToDocument(article: Article): Document {\n  return {\n    id: article.id,\n    name: article.name,\n    description: article.description,\n    tags: '',\n    category: getNewCategoryID(article.main_category),\n    accessibility: 1,\n    content_markdown: article.content_markdown,\n    content_html: article.content_html,\n    author_id: '152981937240150016',\n    created_timestamp: article.created_timestamp,\n    updated_timestamp: article.updated_timestamp,\n  };\n}\n\n// With the old category id return the new category id\nfunction getNewCategoryID(old_id: string): string {\n  switch (old_id) {\n    case '10247724590960640':\n      return '153009590005403656';\n    case '135688451642101760':\n      return '153009590005403651';\n    case '1563846779080705':\n      return '153009357737431040';\n    case '1564500943704066':\n      return '153009357787762689';\n    case '1564753356918787':\n      return '153009357787762690';\n    case '1564854359953412':\n      return '153009357787762691';\n    case '1564994986577925':\n      return '153009357787762692';\n    case '1565265611460614':\n      return '153009357787762692';\n    case '1565634844430343':\n      return '153009590005403648';\n    case '38224311751806976':\n      return '153009590005403649';\n    case '3993900674977792':\n      return '153009590005403650';\n    case '4030806225850368':\n      return '153009590005403651';\n    case '4031642125471745':\n      return '153009590005403652';\n    case '44031625821949952':\n      return '153009590005403653';\n    case '51632421858185216':\n      return '153009590005403654';\n    case '59881276756201472':\n      return '153009590005403655';\n    case '61787697525559296':\n      return '153009590005403656';\n    case '8124080637087744':\n      return '153009590005403648';\n    case '8124501086703617':\n      return '153009590005403648';\n    case '9154132401197056':\n      return '153009590005403652';\n    default:\n      return '153009357737431040';\n  }\n}\n\nconsole.log('Starting migration...');\n\nconst articles = await getAllOldArticles();\nconsole.log('Got all articles.');\nconst documents = articles.map(article => formatArticleToDocument(article));\nconsole.log('Formatted all articles.');\nconsole.log('Starting to insert documents...');\nlet i = 1;\nfor (const document of documents) {\n  console.log(`Inserting document ${document.name}... (${i}/${documents.length})`);\n  i++;\n  await new Promise(resolve => {\n    new_db.query<DocumentDB[]>(\n      'INSERT INTO documents (`id`, `name`, `description`, `tags`, `category`, `accessibility`, `content_markdown`, `content_html`, `author_id`, `created_timestamp`, `updated_timestamp`) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)',\n      [\n        document.id,\n        document.name,\n        document.description,\n        document.tags,\n        document.category,\n        document.accessibility,\n        document.content_markdown,\n        document.content_html,\n        document.author_id,\n        document.created_timestamp,\n        document.updated_timestamp,\n      ],\n      (err, result) => {\n        if (err) console.log(err);\n        console.log(`Inserted document ${document.name}.`);\n        resolve(result);\n      },\n    );\n  });\n}\n\nconsole.log('Migration finished.');\nnew_db.end();\nold_db.end();\n"]}